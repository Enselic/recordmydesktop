name: CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

  workflow_dispatch:

jobs:
  configure-make-install:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2

      - name: sudo apt install build-dependencies
        run: sudo apt install \
          autotools-dev \
          zlib1g-dev \
          libice-dev \
          libsm-dev \
          libxext-dev \
          libxdamage-dev \
          libogg-dev \
          libvorbis-dev \
          libtheora-dev \
          libjack-dev \
          libasound2-dev \
          libpopt-dev

      - name: sh autogen.sh
        run: cd recordmydesktop ; sh autogen.sh

      - name: ./configure --prefix /tmp/recordmydesktop-prefix
        run: cd recordmydesktop ; ./configure --prefix /tmp/recordmydesktop-prefix

      - name: make
        run: cd recordmydesktop ; make

      - name: make install
        run: cd recordmydesktop ; make install
