name: CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

  workflow_dispatch:

jobs:
  configure-make-install:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2

      - name: 'CLI: sudo apt install build-dependencies'
        run: sudo apt install
          autotools-dev
          zlib1g-dev
          libice-dev
          libsm-dev
          libxext-dev
          libxdamage-dev
          libogg-dev
          libvorbis-dev
          libtheora-dev
          libjack-jackd2-dev
          libasound2-dev
          libpopt-dev

      - name: 'CLI: sh autogen.sh'
        run: cd recordmydesktop ; sh autogen.sh

      - name: 'CLI: ./configure --prefix /tmp/recordmydesktop-prefix'
        run: cd recordmydesktop ; ./configure --prefix /tmp/recordmydesktop-prefix

      - name: 'CLI: make'
        run: cd recordmydesktop ; AM_CFLAGS=-Werror make

      - name: 'CLI: make check'
        run: cd recordmydesktop ; AM_CFLAGS=-Werror make check

      - name: 'CLI: make install'
        run: cd recordmydesktop ; make install

      - name: 'GTK: sudo apt install build-dependencies'
        run: sudo apt install
          gettext
          python3-gi
          python3-gi-cairo
          gir1.2-gtk-3.0

      - name: 'GTK: sh autogen.sh'
        run: cd gtk-recordmydesktop ; sh autogen.sh

      - name: 'GTK: ./configure --prefix /tmp/recordmydesktop-prefix'
        run: cd gtk-recordmydesktop ; ./configure --prefix /tmp/recordmydesktop-prefix

      - name: 'GTK: make'
        run: cd gtk-recordmydesktop ; AM_CFLAGS=-Werror make

      - name: 'GTK: make install'
        run: cd gtk-recordmydesktop ; make install
